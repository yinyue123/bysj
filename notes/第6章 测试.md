第5章
	5.1 环境配置
	1.安装DPDK所需软件
	安装基本编译软件:gcc(version>=4.9),make,cmp,sed,grep,arch
	安装依赖C库:libc headers,glibc-devel.i686/libc6-dev-i386,glibc- devel.x86_64/libc6-dev,glibc-devel.ppc64
	安装内核源码:
	yum install kernel-headers-`uname -r`
	yum install kernel-src-`uname-r`
	yum install kernel-devel-`uname-r`
	安装依赖软件和库:
	python(version>=2.7 or version>=3.2)
	pciutils，libudev-devel,boost-devel,zlib-devel,openssl-devel,libpcap-devel,lua-static
	2.编译源码
	# vi ./config/common_base	#修改编译参数
	  CONFIG_RTE_LIBRTE_KNI=y	#编译KNI网卡驱动
	  CONFIG_RTE_LIBRTE_PMD_OPENSSL=y	#编译OPENSSL库
	# export RTE_SDK=/root/ipsec_demo/dpdk-17.02	#添加环境变量
	# export RTE_TARGET=x86_64-native-linuxapp-gcc
	# make install T=x86_64-native-linuxapp-gcc		#编译
	3.配置strongswan证书
	1.生成根证书
	ipsec pki --gen --outform pem > ca.key.pem
	ipsec pki --self --in ca.key.pem --dn "C=CN,O=T2,CN=Test CA" --ca --lifetime 3650 --outform pem > ca.cert.pem > ca.cert.pem
	2.生成服务器证书
	IP=192.168.100.1	#配置服务器连接的地址，配置错误无法连接成功
	ipsec pki --gen --outform pem > server.key.pem
	ipsec pki --pub --in server.key.pem --outform pem > server.pub.pem
	ipsec pki --issue --lifetime 1200 --cacert ca.cert.pem --cakey ca.key.pem --in server.pub.pem --dn "C=CN,O=TZ,CN=Test Server" --san="$IP" --flag serverAuth --flag ikeINtermediate --outform pem > server.cert.pem 
	3.生成客户端证书
	ipsec pki --gen --out form pem > client.key.pem
	ipsec pki --pub --in client.key.pen --outform pem > client.pub.pem
	ipsec pki --issue --lifetime 1200 --cacert ca.cert.pem --cakey ca.cert.pem --in client.pub.pem --dn "C=CN,O=TZ,CN=Test client" --outform pem > client.cert.pem
	4.配置环境
	#加载kni驱动
	rmmod rte_kni
	insmod $RTE_SDK/x86_64-native-linuxapp-gcc/kmod/rte_kni.ko
	#加载驱动
	modprobe uio
	insmod $RTE_SDK/x86_64-native-linuxapp-gcc/kmod/igb_uio.ko
	#配置大页
	echo 1024 > /sys/devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages
	5.配置kni网卡IP，启动程序
	5.2 测试环境
	设备连接如图，客户端电脑和服务端软路由直连，设备配置参数如图。
	设备		配置参数		描述
	软路由	CPU			Intel® Celeron® Processor J1900
						(2M Cache, up to 2.42 GHz)
			RAM			8 GB 1600MHz DDR3L
			网卡			Intel® Ethernet Controller I211-AT
			操作系统		CentOS Linux Minimal 7.3
	电脑		CPU			Intel(R) Core(TM) m3-6Y30 CPU @ 0.90GHz
			RAM			8 GB 1867MHz LPDDR3
			网卡			绿联typec扩展坞(千兆网卡芯片AX88179)
			操作系统		macOS Sierra version 10.12.6
	5.3 测试对象
		ipsec vpn(DPDK):	本论文中描述的程序
		ipsec vpn(Kernel):	内核的IPSec VPN
		加密算法:		aes-128-cbc
		认证算法:		sha1-hmac
	5.4 测试工具
		本文使用iperf3对网关进行UDP包发送测试其性能
	5.5 测试结论
		本程序优点:由图可得，本程序在小包处理方面优于内核IPSec网关，大包处理方面和内核性能持平。
		本程序缺点:由于使用了轮训模式，使CPU一直处于满载状态，随后可根据数据包流量大小适当降低CPU频率，或当数据包比较少时可根据情况让程序休眠一段时间。
		不足之处:由于CPU不支持AES-NI加速技术且没有QAT加速卡，使用OPENSSL的软加密，加密部分存在瓶颈，不能完全测出程序性能。
	5.6 本章小节